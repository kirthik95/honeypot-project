<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Honeypot Dashboard - CVE & CVSS Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Orbitron:wght@500;600;700&family=JetBrains+Mono:wght@400;500&family=Metal+Mania&family=Rajdhani:wght@500;600;700&family=Cinzel:wght@500;600;700&family=Sora:wght@400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0b0b0e 0%, #1a1a2e 100%);
            color: #f2ecdd;
            padding: 20px;
            min-height: 100vh;
        }

        .dashboard-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 20px;
            background: rgba(242, 236, 221, 0.05);
            border-radius: 16px;
            border: 1px solid rgba(242, 236, 221, 0.1);
            position: relative;
        }

        .dashboard-title {
            font-size: 36px;
            font-weight: 700;
            background: linear-gradient(135deg, #f2ecdd 0%, #c7961c 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .dashboard-subtitle {
            font-size: 14px;
            color: rgba(242, 236, 221, 0.6);
        }

        /* Action Buttons */
        .action-buttons {
            position: absolute;
            top: 30px;
            right: 30px;
            display: flex;
            gap: 10px;
        }

        .refresh-btn, .clear-btn {
            padding: 12px 24px;
            border: 1px solid rgba(199, 150, 28, 0.3);
            background: rgba(199, 150, 28, 0.1);
            color: #c7961c;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .refresh-btn:hover {
            background: rgba(199, 150, 28, 0.2);
            border-color: rgba(199, 150, 28, 0.5);
            transform: translateY(-2px);
        }

        .clear-btn {
            border-color: rgba(177, 18, 18, 0.3);
            background: rgba(177, 18, 18, 0.1);
            color: #b11212;
        }

        .clear-btn:hover {
            background: rgba(177, 18, 18, 0.2);
            border-color: rgba(177, 18, 18, 0.5);
            transform: translateY(-2px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(242, 236, 221, 0.05);
            border: 1px solid rgba(242, 236, 221, 0.1);
            border-radius: 12px;
            padding: 24px;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: rgba(199, 150, 28, 0.5);
            box-shadow: 0 8px 32px rgba(199, 150, 28, 0.15);
            transform: translateY(-2px);
        }

        .stat-label {
            font-size: 12px;
            color: rgba(242, 236, 221, 0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #c7961c;
            margin-bottom: 4px;
        }

        .stat-meta {
            font-size: 13px;
            color: rgba(242, 236, 221, 0.5);
        }

        .stat-card.critical .stat-value { color: #b11212; }
        .stat-card.high .stat-value { color: #ff6b35; }
        .stat-card.medium .stat-value { color: #c7961c; }
        .stat-card.low .stat-value { color: #1ea896; }

        /* Behavioral Metrics Section */
        .behavioral-section {
            background: rgba(242, 236, 221, 0.05);
            border: 1px solid rgba(30, 168, 150, 0.3);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 40px;
        }

        .behavioral-title {
            font-size: 20px;
            font-weight: 600;
            color: #1ea896;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .behavioral-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .behavioral-metric {
            background: rgba(30, 168, 150, 0.05);
            border: 1px solid rgba(30, 168, 150, 0.15);
            border-radius: 8px;
            padding: 16px;
        }

        .behavioral-metric-label {
            font-size: 11px;
            color: rgba(242, 236, 221, 0.6);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .behavioral-metric-value {
            font-size: 24px;
            font-weight: 700;
            color: #1ea896;
        }

        .behavioral-metric-range {
            font-size: 10px;
            color: rgba(242, 236, 221, 0.4);
            margin-top: 4px;
        }

        .chart-container {
            background: rgba(242, 236, 221, 0.05);
            border: 1px solid rgba(242, 236, 221, 0.1);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 30px;
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #f2ecdd;
        }

        canvas {
            max-height: 300px;
        }

        .cvss-gauge-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 250px;
            margin: 20px 0;
        }

        .owasp-list {
            list-style: none;
        }

        .owasp-item {
            background: rgba(242, 236, 221, 0.03);
            border-left: 3px solid #c7961c;
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 4px;
        }

        .owasp-category {
            font-size: 14px;
            color: #c7961c;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .owasp-count {
            font-size: 18px;
            font-weight: 700;
            color: #f2ecdd;
        }

        .recent-attacks-table {
            width: 100%;
            border-collapse: collapse;
        }

        .recent-attacks-table th {
            background: rgba(242, 236, 221, 0.05);
            padding: 12px;
            text-align: left;
            font-size: 12px;
            color: rgba(242, 236, 221, 0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid rgba(242, 236, 221, 0.1);
        }

        .recent-attacks-table td {
            padding: 16px 12px;
            border-bottom: 1px solid rgba(242, 236, 221, 0.05);
        }

        .severity-badge {
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .severity-badge.critical {
            background: rgba(177, 18, 18, 0.2);
            color: #b11212;
            border: 1px solid rgba(177, 18, 18, 0.3);
        }

        .severity-badge.high {
            background: rgba(255, 107, 53, 0.2);
            color: #ff6b35;
            border: 1px solid rgba(255, 107, 53, 0.3);
        }

        .severity-badge.medium {
            background: rgba(199, 150, 28, 0.2);
            color: #c7961c;
            border: 1px solid rgba(199, 150, 28, 0.3);
        }

        .severity-badge.low {
            background: rgba(30, 168, 150, 0.2);
            color: #1ea896;
            border: 1px solid rgba(30, 168, 150, 0.3);
        }

        .cve-link {
            color: #c7961c;
            text-decoration: none;
            font-family: monospace;
            font-size: 12px;
        }

        .cve-link:hover {
            text-decoration: underline;
        }

        /* Modal for Clear Confirmation */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: #1a1a2e;
            border: 1px solid rgba(242, 236, 221, 0.2);
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            text-align: center;
        }

        .modal-title {
            font-size: 24px;
            color: #b11212;
            margin-bottom: 15px;
        }

        .modal-text {
            color: rgba(242, 236, 221, 0.8);
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .modal-btn {
            padding: 12px 30px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn-confirm {
            background: #b11212;
            color: white;
        }

        .modal-btn-confirm:hover {
            background: #d41616;
        }

        .modal-btn-cancel {
            background: rgba(242, 236, 221, 0.1);
            color: #f2ecdd;
            border: 1px solid rgba(242, 236, 221, 0.2);
        }

        .modal-btn-cancel:hover {
            background: rgba(242, 236, 221, 0.2);
        }

        /* Loading Spinner */
        .loading {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid rgba(199, 150, 28, 0.3);
            border-top-color: #c7961c;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ============================= */
        /* VISUAL MASTERPIECE LAYER     */
        /* ============================= */

        /* Spatial animated halo */
        .dashboard-halo {
            position: fixed;
            inset: -30%;
            background:
                radial-gradient(circle at 50% 30%,
                var(--mode-accent-soft), transparent 60%);
            pointer-events: none;
            z-index: -1;
            animation: haloPulse 12s ease-in-out infinite alternate;
        }

        @keyframes haloPulse {
            from { transform: scale(1); opacity: 0.4; }
            to { transform: scale(1.1); opacity: 0.7; }
        }

        /* 3D Floating Stat Cards */
        .stat-card {
            transform-style: preserve-3d;
            transition: transform 0.4s ease, box-shadow 0.4s ease;
        }

        .stat-card:hover {
            transform: translateY(-10px) rotateX(6deg) rotateY(-6deg);
            box-shadow:
                0 25px 70px rgba(199,150,28,0.3),
                0 0 100px rgba(177,18,18,0.2);
        }

        /* Subtle chart glow */
        .chart-container {
            position: relative;
        }

        .chart-container::before {
            content: '';
            position: absolute;
            inset: -20px;
            background: radial-gradient(circle,
                rgba(242,236,221,0.12), transparent 70%);
            z-index: -1;
            opacity: 0.8;
        }

        /* Smooth hover on recent attack rows */
        .recent-attacks-table tbody tr {
            transition: background 0.3s ease, transform 0.2s ease;
        }

        .recent-attacks-table tbody tr:hover {
            background: rgba(242,236,221,0.05);
            transform: translateX(4px);
        }

        /* Modal depth */
        .modal-content {
            backdrop-filter: blur(16px);
            box-shadow: 0 40px 120px rgba(0,0,0,0.7);
        }

        /* Soft pulse animation for critical numbers */
        @keyframes pulseGlow {
            0% { text-shadow: 0 0 0 rgba(177,18,18,0.4); }
            50% { text-shadow: 0 0 12px rgba(177,18,18,0.8); }
            100% { text-shadow: 0 0 0 rgba(177,18,18,0.4); }
        }

        .stat-card.critical .stat-value {
            animation: pulseGlow 2.5s infinite;
        }

        /* ============================= */
        /* LIVE MOTION / DEPTH FX LAYER  */
        /* ============================= */

        /* Depth-based parallax scroll (background layers) */
        .parallax-layer {
            position: fixed;
            inset: -25%;
            pointer-events: none;
            z-index: 0;
            opacity: 0.9;
            will-change: transform;
        }

        .parallax-layer.layer-a {
            background:
                radial-gradient(900px circle at 18% 22%, rgba(242, 236, 221, 0.09), transparent 60%),
                radial-gradient(800px circle at 82% 28%, rgba(199, 150, 28, 0.12), transparent 62%),
                radial-gradient(700px circle at 62% 82%, rgba(177, 18, 18, 0.10), transparent 60%);
            filter: blur(0.2px);
            mix-blend-mode: screen;
        }

        .parallax-layer.layer-b {
            background:
                repeating-linear-gradient(
                    90deg,
                    rgba(242, 236, 221, 0.045) 0,
                    rgba(242, 236, 221, 0.045) 1px,
                    transparent 1px,
                    transparent 42px
                ),
                repeating-linear-gradient(
                    0deg,
                    rgba(242, 236, 221, 0.03) 0,
                    rgba(242, 236, 221, 0.03) 1px,
                    transparent 1px,
                    transparent 52px
                );
            opacity: 0.28;
            transform: translate3d(0, 0, 0);
            mix-blend-mode: overlay;
        }

        /* Ensure content sits above parallax layers without affecting fixed overlays */
        body > :not(.parallax-layer):not(.dashboard-halo):not(.gradient-overlay):not(.glitter-overlay):not(.orbital-field) {
            position: relative;
            z-index: 1;
        }

        /* Mouse tilt tracking */
        .tilt-card {
            position: relative;
            overflow: hidden;
            transform-style: preserve-3d;
            will-change: transform;
            --rx: 0deg;
            --ry: 0deg;
            --mx: 50%;
            --my: 50%;
        }

        .tilt-card::after {
            content: '';
            position: absolute;
            inset: -40%;
            background: radial-gradient(520px circle at var(--mx) var(--my),
                rgba(242, 236, 221, 0.16), transparent 52%);
            opacity: 0;
            transition: opacity 180ms ease;
            pointer-events: none;
            mix-blend-mode: screen;
            transform: translateZ(0);
        }

        .tilt-card.tilt-active::after {
            opacity: 1;
        }

        /* Override static hover tilt with dynamic transform when JS is active */
        .tilt-card.tilt-active {
            transform: translateY(-10px) rotateX(var(--rx)) rotateY(var(--ry));
            box-shadow:
                0 25px 70px rgba(199,150,28,0.3),
                0 0 110px rgba(177,18,18,0.18);
        }

        /* Live "new attack" flash animation */
        @keyframes newAttackFlash {
            0% {
                background: rgba(177,18,18,0.22);
                box-shadow: 0 0 0 rgba(177,18,18,0.0);
                transform: translateX(0);
            }
            18% {
                background: rgba(177,18,18,0.10);
                box-shadow: 0 0 18px rgba(177,18,18,0.35);
                transform: translateX(6px);
            }
            100% {
                background: transparent;
                box-shadow: 0 0 0 rgba(177,18,18,0.0);
                transform: translateX(0);
            }
        }

        .recent-attacks-table tbody tr.attack-row-new {
            animation: newAttackFlash 1600ms ease-out 1;
        }

        .recent-attacks-table tbody tr.attack-row-selected {
            background: var(--mode-accent-soft);
            outline: 1px solid var(--mode-accent);
            outline-offset: -1px;
        }

        /* WebGL gauge overlay label */
        .cvss-gauge-container {
            position: relative;
        }

        #cvssGauge {
            width: min(360px, 100%);
            height: 240px;
        }

        .cvss-gauge-overlay {
            position: absolute;
            inset: 0;
            display: grid;
            place-items: center;
            pointer-events: none;
        }

        .cvss-gauge-value {
            font-size: 48px;
            font-weight: 800;
            letter-spacing: 0.02em;
            line-height: 1;
            background: linear-gradient(135deg, #f2ecdd 0%, var(--mode-accent) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 24px var(--mode-accent-soft);
        }

        .cvss-gauge-sub {
            margin-top: 6px;
            font-size: 11px;
            color: rgba(242,236,221,0.55);
            letter-spacing: 0.16em;
            text-transform: uppercase;
        }

        /* AI analysis panel */
        .ai-panel {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .ai-meta {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
            color: rgba(242,236,221,0.6);
            font-size: 12px;
        }

        .ai-pill {
            padding: 6px 10px;
            border-radius: 999px;
            border: 1px solid rgba(242,236,221,0.16);
            background: rgba(242,236,221,0.06);
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            color: rgba(242,236,221,0.8);
        }

        .ai-text {
            padding: 14px 16px;
            border-radius: 12px;
            border: 1px solid rgba(242,236,221,0.10);
            background: rgba(5,5,5,0.28);
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 13px;
            line-height: 1.55;
            color: rgba(242,236,221,0.86);
            white-space: pre-wrap;
            min-height: 110px;
        }

        /* Live toast for new attacks */
        .live-toast {
            position: fixed;
            top: 18px;
            left: 18px;
            max-width: min(560px, calc(100vw - 36px));
            padding: 12px 14px;
            border-radius: 14px;
            background: rgba(177,18,18,0.16);
            border: 1px solid rgba(177,18,18,0.35);
            box-shadow: 0 25px 70px rgba(0,0,0,0.55);
            z-index: 1200;
            backdrop-filter: blur(12px);
            animation: liveToastIn 220ms ease-out;
        }

        .live-toast-title {
            font-size: 12px;
            font-weight: 800;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: rgba(242,236,221,0.92);
            margin-bottom: 4px;
        }

        .live-toast-body {
            font-size: 13px;
            color: rgba(242,236,221,0.78);
        }

        @keyframes liveToastIn {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes liveToastOut {
            from { transform: translateY(0); opacity: 1; }
            to { transform: translateY(-10px); opacity: 0; }
        }

        /* ============================= */
        /* CREATIVE RESKIN LAYER         */
        /* ============================= */

        :root {
            --tone-ink: #0b0b0e;
            --tone-mid: #1a1a2e;
            --tone-gold: #c7961c;
            --tone-red: #b11212;
            --tone-teal: #1ea896;
            --tone-ivory: #f2ecdd;
        }

        body {
            position: relative;
            overflow-x: hidden;
            isolation: isolate;
            background:
                radial-gradient(1200px circle at 18% -10%, rgba(30, 168, 150, 0.09), transparent 60%),
                radial-gradient(1000px circle at 84% 10%, var(--mode-accent-soft), transparent 58%),
                radial-gradient(900px circle at 70% 90%, rgba(177, 18, 18, 0.12), transparent 62%),
                linear-gradient(130deg, #09090d 0%, #151728 54%, #101016 100%);
        }

        body::before,
        body::after {
            content: '';
            position: fixed;
            inset: -25%;
            pointer-events: none;
            z-index: 0;
        }

        body::before {
            background:
                repeating-linear-gradient(
                    90deg,
                    rgba(242, 236, 221, 0.04) 0,
                    rgba(242, 236, 221, 0.04) 1px,
                    transparent 1px,
                    transparent 38px
                );
            opacity: 0.20;
            mix-blend-mode: overlay;
            animation: gridDrift 24s linear infinite;
        }

        body::after {
            background: radial-gradient(650px circle at 50% 35%, rgba(242, 236, 221, 0.08), transparent 72%);
            opacity: 0.45;
            animation: auraDrift 15s ease-in-out infinite alternate;
        }

        @keyframes gridDrift {
            from { transform: translate3d(0, 0, 0); }
            to { transform: translate3d(-32px, 0, 0); }
        }

        @keyframes auraDrift {
            from { transform: scale(1); opacity: 0.30; }
            to { transform: scale(1.08); opacity: 0.56; }
        }

        .dashboard-header,
        .behavioral-section,
        .chart-container,
        .stat-card,
        .behavioral-metric {
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        .dashboard-header {
            background: linear-gradient(130deg, rgba(242, 236, 221, 0.08), rgba(242, 236, 221, 0.02));
            border: 1px solid rgba(242, 236, 221, 0.16);
            box-shadow: 0 16px 80px rgba(0, 0, 0, 0.45);
        }

        .stats-grid {
            gap: 24px;
        }

        .stat-card {
            --accent-rgb: 199, 150, 28;
            position: relative;
            overflow: hidden;
            border-radius: 16px;
            border: 1px solid rgba(var(--accent-rgb), 0.24);
            background:
                linear-gradient(140deg, rgba(242, 236, 221, 0.07), rgba(242, 236, 221, 0.01) 60%),
                rgba(8, 8, 12, 0.46);
            box-shadow:
                inset 0 0 0 1px rgba(255, 255, 255, 0.04),
                0 18px 44px rgba(0, 0, 0, 0.44);
            transition: transform 0.35s ease, box-shadow 0.35s ease, border-color 0.35s ease;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(
                120deg,
                transparent 0%,
                rgba(var(--accent-rgb), 0.14) 36%,
                transparent 66%
            );
            transform: translateX(-125%);
            opacity: 0.42;
            transition: transform 0.8s ease;
            pointer-events: none;
        }

        .stat-card::after {
            content: '';
            position: absolute;
            left: 12px;
            right: 12px;
            bottom: 8px;
            height: 2px;
            border-radius: 999px;
            background: linear-gradient(90deg, transparent, rgba(var(--accent-rgb), 0.85), transparent);
            opacity: 0.8;
        }

        .stat-card:hover::before {
            transform: translateX(125%);
        }

        .stat-card:hover:not(.tilt-active) {
            border-color: rgba(var(--accent-rgb), 0.48);
            box-shadow:
                inset 0 0 0 1px rgba(255, 255, 255, 0.06),
                0 26px 66px rgba(0, 0, 0, 0.52),
                0 0 32px rgba(var(--accent-rgb), 0.22);
            transform: translateY(-6px);
        }

        .stat-card.critical { --accent-rgb: 177, 18, 18; }
        .stat-card.high { --accent-rgb: 255, 107, 53; }
        .stat-card.medium { --accent-rgb: 199, 150, 28; }
        .stat-card.low { --accent-rgb: 30, 168, 150; }

        .stat-label {
            color: rgba(242, 236, 221, 0.72);
            font-weight: 600;
        }

        .stat-value {
            text-shadow: 0 0 16px rgba(var(--accent-rgb), 0.22);
        }

        .stat-card.value-pulse .stat-value {
            animation: statPulse 520ms ease-out;
        }

        @keyframes statPulse {
            0% { transform: scale(1); filter: brightness(1); }
            30% { transform: scale(1.09); filter: brightness(1.2); }
            100% { transform: scale(1); filter: brightness(1); }
        }

        .behavioral-section {
            border-radius: 16px;
            border: 1px solid rgba(30, 168, 150, 0.28);
            background:
                linear-gradient(140deg, rgba(30, 168, 150, 0.10), rgba(30, 168, 150, 0.02) 58%),
                rgba(8, 10, 14, 0.42);
            box-shadow: inset 0 0 0 1px rgba(30, 168, 150, 0.08), 0 16px 40px rgba(0, 0, 0, 0.35);
        }

        .behavioral-metric {
            border-radius: 12px;
            border: 1px solid rgba(30, 168, 150, 0.22);
            background: linear-gradient(140deg, rgba(30, 168, 150, 0.12), rgba(8, 9, 12, 0.4));
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.24);
        }

        .chart-container {
            border-radius: 16px;
            border: 1px solid rgba(242, 236, 221, 0.16);
            background:
                linear-gradient(135deg, rgba(242, 236, 221, 0.07), rgba(242, 236, 221, 0.02) 58%),
                rgba(8, 8, 12, 0.45);
            box-shadow:
                inset 0 0 0 1px rgba(255, 255, 255, 0.04),
                0 16px 44px rgba(0, 0, 0, 0.38);
        }

        .chart-title {
            letter-spacing: 0.04em;
        }

        .cvss-gauge-container {
            min-height: 270px;
            border-radius: 14px;
            border: 1px dashed rgba(242, 236, 221, 0.18);
            background:
                radial-gradient(700px circle at 50% 10%, rgba(30, 168, 150, 0.10), transparent 58%),
                linear-gradient(160deg, rgba(12, 12, 20, 0.42), rgba(8, 8, 12, 0.55));
            overflow: hidden;
        }

        #cvssGauge {
            filter: drop-shadow(0 0 28px rgba(30, 168, 150, 0.22));
        }

        .recent-attacks-table {
            border-collapse: separate;
            border-spacing: 0 10px;
        }

        .recent-attacks-table thead th {
            border-bottom: none;
            font-size: 11px;
            color: rgba(242, 236, 221, 0.68);
            letter-spacing: 0.12em;
        }

        .recent-attacks-table tbody tr {
            --rowx: 50%;
            position: relative;
            overflow: hidden;
            background:
                radial-gradient(220px circle at var(--rowx) 50%, var(--mode-accent-soft), transparent 68%),
                linear-gradient(120deg, rgba(242, 236, 221, 0.06), rgba(242, 236, 221, 0.02));
            border: 1px solid rgba(242, 236, 221, 0.14);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.26);
        }

        .recent-attacks-table td {
            border-bottom: none;
        }

        .recent-attacks-table tbody tr td:first-child {
            border-top-left-radius: 12px;
            border-bottom-left-radius: 12px;
            border-left: 1px solid rgba(242, 236, 221, 0.14);
        }

        .recent-attacks-table tbody tr td:last-child {
            border-top-right-radius: 12px;
            border-bottom-right-radius: 12px;
            border-right: 1px solid rgba(242, 236, 221, 0.14);
        }

        .recent-attacks-table tbody tr:hover {
            transform: translateX(8px) scale(1.01);
            box-shadow:
                0 16px 42px rgba(0, 0, 0, 0.34),
                0 0 18px var(--mode-accent-soft);
        }

        .fx-ambient-canvas {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 3;
            opacity: 0.62;
        }

        /* ============================= */
        /* INDEX THEME ALIGNMENT         */
        /* ============================= */

        :root {
            --black-gold: #C7961C;
            --silver: #F2ECDD;
            --gold: var(--black-gold);
            --gold-bright: var(--silver);
            --red: #B11212;
            --ink: #050505;
            --ink-2: #0B0B0E;
            --text-primary: #F5F1E6;
            --text-secondary: rgba(245, 241, 230, 0.7);
            --text-muted: rgba(245, 241, 230, 0.45);
            --font-body: 'Space Grotesk', 'Segoe UI', sans-serif;
            --font-display: 'Orbitron', 'Space Grotesk', sans-serif;
            --font-hades-body: 'Rajdhani', 'Space Grotesk', sans-serif;
            --font-hades-display: 'Metal Mania', 'Orbitron', sans-serif;
            --font-zeus-body: 'Sora', 'Space Grotesk', sans-serif;
            --font-zeus-display: 'Cinzel', 'Orbitron', serif;
            --mode-accent: rgba(162,102,255,0.88);
            --mode-accent-soft: rgba(176,120,255,0.30);
            --fire-gradient: linear-gradient(135deg, var(--red) 0%, #050505 100%);
            --fire-gradient-soft: linear-gradient(135deg, var(--red) 0%, var(--black-gold) 35%, var(--silver) 58%, #050505 100%);
        }

        body {
            font-family: var(--font-body);
            color: var(--text-primary);
            background:
                radial-gradient(1200px circle at 20% -10%, rgba(242, 236, 221, 0.14), transparent 55%),
                linear-gradient(180deg, var(--ink) 0%, var(--ink-2) 60%, var(--ink) 100%);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            padding: 20px;
            min-height: 100vh;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background-image:
                linear-gradient(rgba(242, 236, 221, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(242, 236, 221, 0.05) 1px, transparent 1px);
            background-size: 80px 80px;
            opacity: 0.18;
            pointer-events: none;
            z-index: 1;
        }

        body::after {
            content: '';
            position: fixed;
            inset: 0;
            background: repeating-linear-gradient(
                0deg,
                rgba(255, 255, 255, 0.03) 0,
                rgba(255, 255, 255, 0.03) 1px,
                transparent 1px,
                transparent 3px
            );
            opacity: 0.12;
            pointer-events: none;
            z-index: 1;
        }

        .gradient-overlay {
            position: fixed;
            inset: 0;
            background: radial-gradient(
                ellipse at top,
                rgba(242, 236, 221, 0.18) 0%,
                rgba(5, 5, 5, 0.35) 45%,
                rgba(5, 5, 5, 0.78) 100%
            );
            pointer-events: none;
            z-index: 2;
        }

        .glitter-overlay {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 2;
            mix-blend-mode: screen;
            opacity: 0.24;
            background-image:
                radial-gradient(circle at 18% 22%, rgba(242, 236, 221, 0.7) 0 0.9px, transparent 1.8px),
                radial-gradient(circle at 72% 28%, rgba(242, 236, 221, 0.35) 0 1px, transparent 2px),
                radial-gradient(circle at 62% 72%, rgba(199, 150, 28, 0.5) 0 0.9px, transparent 2px),
                radial-gradient(circle at 14% 78%, rgba(177, 18, 18, 0.3) 0 0.8px, transparent 1.8px),
                repeating-radial-gradient(circle, rgba(255, 255, 255, 0.14) 0 0.6px, transparent 1.6px);
            background-size: 140px 140px, 220px 220px, 180px 180px, 260px 260px, 3px 3px;
            animation: glitterDrift 18s linear infinite, glitterTwinkle 3.4s ease-in-out infinite alternate;
            filter: saturate(1.2) brightness(1.05);
        }

        @keyframes glitterDrift {
            from { background-position: 0 0, 0 0, 0 0, 0 0, 0 0; }
            to { background-position: 120px 180px, -140px 220px, 80px -120px, -60px 160px, 20px 40px; }
        }

        @keyframes glitterTwinkle {
            from { opacity: 0.16; }
            to { opacity: 0.30; }
        }

        .orbital-field {
            position: fixed;
            inset: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none;
            z-index: 2;
            opacity: 0.14;
            animation: slowRotate 120s linear infinite;
        }

        .orbital-svg {
            width: 900px;
            height: 900px;
        }

        .orbit-ring {
            fill: none;
            stroke: rgba(150, 110, 245, 0.22);
            stroke-width: 1.5;
            stroke-dasharray: 6 8;
        }

        .orbit-ring.faint {
            stroke: rgba(192, 173, 240, 0.12);
        }

        @keyframes slowRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .dashboard-header,
        .stats-grid,
        .behavioral-section,
        .chart-container,
        .modal {
            position: relative;
            z-index: 4;
        }

        .dashboard-title {
            font-family: var(--font-display);
            letter-spacing: 0.08em;
            text-transform: uppercase;
            background: var(--fire-gradient-soft);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .dashboard-subtitle {
            color: var(--text-secondary);
            font-family: var(--font-body);
            letter-spacing: 0.04em;
        }

        .chart-title,
        .behavioral-title {
            font-family: var(--font-display);
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }

        .chart-title {
            color: var(--gold-bright);
        }

        .behavioral-title {
            color: var(--black-gold);
        }

        .behavioral-section {
            border-color: rgba(199, 150, 28, 0.26);
            background:
                linear-gradient(140deg, rgba(199, 150, 28, 0.12), rgba(177, 18, 18, 0.06) 58%),
                rgba(8, 10, 14, 0.42);
        }

        .behavioral-metric {
            border-color: rgba(242, 236, 221, 0.2);
            background: linear-gradient(140deg, rgba(242, 236, 221, 0.08), rgba(8, 9, 12, 0.42));
        }

        .behavioral-metric-value {
            color: var(--gold-bright);
            font-family: var(--font-display);
        }

        .stat-value {
            font-family: var(--font-display);
            letter-spacing: 0.05em;
        }

        .stat-label,
        .recent-attacks-table th {
            font-family: var(--font-display);
            letter-spacing: 0.12em;
            color: var(--text-secondary);
        }

        .stat-meta,
        .behavioral-metric-range,
        .recent-attacks-table td {
            color: var(--text-secondary);
        }

        .recent-attacks-table td code,
        .cve-link {
            font-family: 'JetBrains Mono', monospace;
        }

        .refresh-btn,
        .clear-btn {
            font-family: var(--font-display);
            letter-spacing: 0.08em;
            text-transform: uppercase;
            border-color: rgba(242, 236, 221, 0.35);
            color: var(--gold-bright);
            background: rgba(8, 8, 10, 0.6);
        }

        .refresh-btn:hover {
            background: var(--fire-gradient);
            color: #050505;
        }

        .clear-btn {
            border-color: rgba(177, 18, 18, 0.45);
            color: var(--red);
        }

        body[data-fx-mode='zeus'] {
            --mode-accent: rgba(64,122,255,0.92);
            --mode-accent-soft: rgba(64,122,255,0.34);
            --font-body: var(--font-zeus-body);
            --font-display: var(--font-zeus-display);
            --fire-gradient: linear-gradient(135deg, #03112e 0%, #1246c8 55%, #86c1ff 100%);
            background:
                radial-gradient(1350px circle at 18% -12%, rgba(102,166,255,0.22), transparent 58%),
                radial-gradient(980px circle at 82% 6%, rgba(22,74,206,0.30), transparent 56%),
                radial-gradient(760px circle at 55% 102%, rgba(16,53,160,0.22), transparent 62%),
                linear-gradient(180deg, #01040f 0%, #031435 54%, #010710 100%);
        }

        body[data-fx-mode='helios'] {
            --mode-accent: rgba(255,106,42,0.90);
            --mode-accent-soft: rgba(255,170,88,0.35);
            --fire-gradient: linear-gradient(135deg, #6d100d 0%, #e84b1f 52%, #ff9f3e 100%);
            background:
                radial-gradient(1220px circle at 18% -10%, rgba(255,149,75,0.22), transparent 58%),
                radial-gradient(820px circle at 82% 12%, rgba(255,58,35,0.22), transparent 58%),
                linear-gradient(180deg, #110806 0%, #29110c 56%, #130907 100%);
        }

        body[data-fx-mode='hades'] {
            --mode-accent: rgba(255,142,54,0.94);
            --mode-accent-soft: rgba(210,70,255,0.30);
            --hades-soul: rgba(206,78,255,0.34);
            --hades-ember: rgba(255,130,54,0.36);
            --hades-ash: rgba(248,230,204,0.30);
            --hades-iron: rgba(74,18,36,0.64);
            --font-body: var(--font-hades-body);
            --font-display: var(--font-hades-display);
            --fire-gradient: linear-gradient(135deg, #12050f 0%, #3b0b2e 46%, #ff7b2f 100%);
            background:
                radial-gradient(1280px circle at 18% -10%, rgba(255,136,64,0.24), transparent 58%),
                radial-gradient(980px circle at 84% 8%, rgba(198,66,255,0.26), transparent 58%),
                radial-gradient(760px circle at 52% 14%, rgba(255,220,178,0.12), transparent 60%),
                linear-gradient(180deg, #09030d 0%, #130515 52%, #050208 100%);
        }

        body[data-fx-mode='zeus'] .orbit-ring { stroke: rgba(112,178,255,0.24); }
        body[data-fx-mode='zeus'] .orbit-ring.faint { stroke: rgba(176,220,255,0.14); }
        body[data-fx-mode='helios'] .orbit-ring { stroke: rgba(255,118,74,0.22); }
        body[data-fx-mode='helios'] .orbit-ring.faint { stroke: rgba(255,170,126,0.12); }
        body[data-fx-mode='hades'] .orbit-ring { stroke: rgba(255,148,72,0.28); }
        body[data-fx-mode='hades'] .orbit-ring.faint { stroke: rgba(198,76,255,0.16); }

        body[data-fx-mode='zeus'] .dashboard-halo {
            background: radial-gradient(circle at 50% 30%, rgba(72,136,255,0.42), transparent 64%);
        }

        body[data-fx-mode='zeus'] .gradient-overlay {
            background: radial-gradient(
                ellipse at top,
                rgba(82, 148, 255, 0.24) 0%,
                rgba(6, 14, 36, 0.54) 45%,
                rgba(2, 6, 16, 0.86) 100%
            );
        }

        body[data-fx-mode='zeus'] .glitter-overlay {
            background-image:
                radial-gradient(circle at 18% 22%, rgba(214, 236, 255, 0.72) 0 0.9px, transparent 1.8px),
                radial-gradient(circle at 72% 28%, rgba(121, 178, 255, 0.44) 0 1px, transparent 2px),
                radial-gradient(circle at 62% 72%, rgba(74, 125, 255, 0.52) 0 0.9px, transparent 2px),
                radial-gradient(circle at 14% 78%, rgba(161, 206, 255, 0.34) 0 0.8px, transparent 1.8px),
                repeating-radial-gradient(circle, rgba(195, 223, 255, 0.14) 0 0.6px, transparent 1.6px);
            filter: saturate(1.08) brightness(1.02);
        }

        body[data-fx-mode='helios'] .dashboard-halo {
            background: radial-gradient(circle at 50% 30%, rgba(255,106,42,0.34), transparent 62%);
        }

        body[data-fx-mode='hades'] .dashboard-halo {
            background: radial-gradient(circle at 50% 30%, rgba(255,136,64,0.34), transparent 62%);
        }

        body[data-fx-mode='hades'] .dashboard-halo::after {
            content: '';
            position: absolute;
            inset: 9% 15%;
            pointer-events: none;
            border-radius: 50%;
            background: repeating-radial-gradient(
                circle at 50% 50%,
                rgba(255,210,164,0.16) 0 11px,
                rgba(203,78,255,0.10) 11px 22px,
                transparent 22px 34px
            );
            mix-blend-mode: screen;
            opacity: 0.44;
            animation: soulWail 6.8s ease-in-out infinite alternate;
        }

        @keyframes soulWail {
            from { transform: scale(0.92) rotate(-3deg); filter: blur(0.7px); }
            to { transform: scale(1.08) rotate(3deg); filter: blur(1.5px); }
        }

        body[data-fx-mode='hades'] .chart-container,
        body[data-fx-mode='hades'] .stat-card,
        body[data-fx-mode='hades'] .behavioral-metric,
        body[data-fx-mode='hades'] .dashboard-header {
            border-color: rgba(255,130,60,0.44);
            box-shadow:
                inset 0 0 0 1px rgba(248,229,203,0.06),
                0 0 28px rgba(84,20,74,0.30);
        }

        body[data-fx-mode='hades'] .myth-btn:hover,
        body[data-fx-mode='hades'] .myth-btn.active {
            color: #fff0db;
            background: linear-gradient(135deg, rgba(56,14,40,0.95), rgba(255,126,56,0.92));
        }

        body[data-fx-mode='hades'] .dashboard-title,
        body[data-fx-mode='hades'] .chart-title,
        body[data-fx-mode='hades'] .behavioral-title {
            letter-spacing: 0.10em;
            text-shadow:
                0 0 14px rgba(255,204,154,0.24),
                0 0 24px rgba(212,70,255,0.28);
        }

        body[data-fx-mode='hades'] .dashboard-header {
            background:
                linear-gradient(140deg, rgba(18,6,16,0.94), rgba(46,10,40,0.84) 62%),
                radial-gradient(580px circle at 50% 4%, rgba(255,146,72,0.18), transparent 60%);
            overflow: hidden;
        }

        body[data-fx-mode='hades'] .dashboard-header::before {
            content: '';
            position: absolute;
            inset: -40% -10%;
            pointer-events: none;
            background: repeating-conic-gradient(
                from 0deg at 50% 34%,
                rgba(255,208,162,0.10) 0deg 8deg,
                rgba(196,74,255,0.08) 8deg 14deg,
                transparent 14deg 24deg
            );
            opacity: 0.24;
            animation: soulWail 9.4s ease-in-out infinite alternate;
            mix-blend-mode: screen;
        }

        body[data-fx-mode='zeus'] .dashboard-title,
        body[data-fx-mode='zeus'] .chart-title,
        body[data-fx-mode='zeus'] .behavioral-title {
            letter-spacing: 0.08em;
            text-shadow:
                0 0 18px rgba(120,188,255,0.34),
                0 0 30px rgba(53,111,255,0.28);
        }

        .action-buttons {
            top: 16px;
            right: 16px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 10px;
        }

        .myth-controls {
            display: grid;
            grid-template-columns: repeat(3, minmax(88px, 1fr));
            gap: 8px;
            width: min(390px, calc(100vw - 48px));
        }

        .myth-btn {
            border: 1px solid rgba(242,236,221,0.28);
            background: linear-gradient(135deg, rgba(8,8,10,0.78), rgba(18,18,26,0.68));
            color: var(--text-secondary);
            border-radius: 12px;
            padding: 9px 10px;
            font-family: var(--font-display);
            font-size: 10px;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            cursor: pointer;
            transition: transform 0.22s ease, box-shadow 0.22s ease, border-color 0.22s ease, color 0.22s ease;
            position: relative;
            overflow: hidden;
            isolation: isolate;
        }

        .myth-btn::before {
            content: '';
            position: absolute;
            inset: -1px;
            background: linear-gradient(115deg, transparent 12%, var(--mode-accent-soft) 50%, transparent 84%);
            transform: translateX(-120%);
            transition: transform 0.52s ease;
            pointer-events: none;
        }

        .myth-btn:hover::before,
        .myth-btn.active::before {
            transform: translateX(120%);
        }

        .myth-btn:hover,
        .myth-btn.active {
            color: #050505;
            border-color: var(--mode-accent);
            background: linear-gradient(135deg, rgba(242,236,221,0.88), var(--mode-accent));
            box-shadow: 0 0 20px var(--mode-accent-soft);
            transform: translateY(-2px);
        }

        .myth-btn.zeus { border-color: rgba(124,184,255,0.36); }
        .myth-btn.helios { border-color: rgba(255,126,62,0.42); }
        .myth-btn.hades { border-color: rgba(214,92,69,0.52); }

        @keyframes abyssPulse {
            0%, 100% {
                box-shadow: 0 0 12px rgba(212,84,63,0.34), 0 0 0 rgba(248,201,156,0.0);
                transform: translateY(-2px) scale(1);
            }
            50% {
                box-shadow: 0 0 28px rgba(224,112,82,0.52), 0 0 42px rgba(129,96,236,0.30);
                transform: translateY(-3px) scale(1.02);
            }
        }

        @keyframes abyssChartPulse {
            from { opacity: 0.16; transform: scale(0.985); }
            to { opacity: 0.40; transform: scale(1.015); }
        }

        @keyframes hadesBladeSweep {
            0%, 54%, 100% { opacity: 0; transform: translateX(-140%) skewX(-18deg); }
            57% { opacity: 0.95; transform: translateX(-6%) skewX(-18deg); }
            60% { opacity: 0; transform: translateX(18%) skewX(-18deg); }
            82% { opacity: 0.75; transform: translateX(84%) skewX(-18deg); }
            85% { opacity: 0; transform: translateX(114%) skewX(-18deg); }
        }

        @keyframes zeusArc {
            0%, 56%, 100% { opacity: 0; transform: translateX(-135%) skewX(-16deg); }
            58% { opacity: 0.96; transform: translateX(6%) skewX(-16deg); }
            60% { opacity: 0; transform: translateX(22%) skewX(-16deg); }
            82% { opacity: 0.88; transform: translateX(84%) skewX(-16deg); }
            84% { opacity: 0; transform: translateX(110%) skewX(-16deg); }
        }

        @keyframes zeusChartSurge {
            0%, 100% { opacity: 0.14; }
            50% { opacity: 0.34; }
        }

        body[data-fx-mode='hades'] .myth-btn.active,
        body[data-fx-mode='hades'] .myth-btn:hover {
            animation: abyssPulse 1.6s ease-in-out infinite;
        }

        body[data-fx-mode='hades'] .myth-btn {
            background: linear-gradient(140deg, rgba(16,6,14,0.92), rgba(42,10,34,0.84));
            border-color: rgba(255,128,58,0.44);
            color: rgba(248,229,203,0.88);
            text-shadow: 0 0 12px rgba(255,134,60,0.26);
        }

        body[data-fx-mode='hades'] .myth-btn::before {
            background: linear-gradient(118deg, transparent 8%, rgba(255,190,122,0.24) 42%, rgba(208,70,255,0.34) 54%, transparent 88%);
        }

        body[data-fx-mode='hades'] .myth-btn:hover::after,
        body[data-fx-mode='hades'] .myth-btn.active::after {
            content: '';
            position: absolute;
            inset: -32% -16%;
            pointer-events: none;
            background: linear-gradient(108deg, transparent 42%, rgba(255,232,200,0.92) 50%, transparent 58%);
            animation: hadesBladeSweep 1.9s steps(1, end) infinite;
            mix-blend-mode: screen;
        }

        body[data-fx-mode='hades'] .chart-container {
            border-color: rgba(255,124,56,0.42);
            background:
                linear-gradient(150deg, rgba(14,6,14,0.94), rgba(36,9,34,0.92) 58%),
                radial-gradient(760px circle at 12% 10%, rgba(255,128,58,0.22), transparent 60%),
                radial-gradient(720px circle at 88% 0%, rgba(198,70,255,0.18), transparent 64%);
            box-shadow:
                inset 0 0 0 1px rgba(255,255,255,0.05),
                0 0 30px rgba(82,18,78,0.34);
            transition: transform 0.26s ease, box-shadow 0.26s ease, border-color 0.26s ease;
        }

        body[data-fx-mode='hades'] .chart-container::after {
            content: '';
            position: absolute;
            inset: 0;
            pointer-events: none;
            border-radius: inherit;
            background:
                radial-gradient(circle at 20% 12%, rgba(255,146,72,0.30), transparent 58%),
                linear-gradient(112deg, transparent 20%, rgba(214,74,255,0.22) 46%, transparent 76%);
            opacity: 0.28;
            animation: abyssChartPulse 4.8s ease-in-out infinite alternate;
        }

        body[data-fx-mode='hades'] .chart-container:hover {
            transform: translateY(-3px);
            border-color: rgba(255,148,76,0.56);
            box-shadow:
                inset 0 0 0 1px rgba(255,255,255,0.06),
                0 0 34px rgba(118,24,98,0.42);
        }

        body[data-fx-mode='hades'] .cvss-gauge-container {
            border-color: rgba(255,134,64,0.34);
            background:
                radial-gradient(760px circle at 50% 8%, rgba(255,136,66,0.24), transparent 58%),
                radial-gradient(560px circle at 50% 88%, rgba(200,72,255,0.20), transparent 58%),
                linear-gradient(158deg, rgba(16,6,14,0.88), rgba(40,10,34,0.90));
            box-shadow: inset 0 0 0 1px rgba(248,229,203,0.08), 0 0 28px rgba(86,18,82,0.34);
        }

        body[data-fx-mode='hades'] #cvssGauge {
            filter: drop-shadow(0 0 18px rgba(255,130,58,0.34)) drop-shadow(0 0 30px rgba(198,70,255,0.28));
        }

        body[data-fx-mode='hades'] .cvss-gauge-value {
            background: linear-gradient(135deg, #f8e9d3 0%, #ff9a4c 56%, #d44aff 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 28px rgba(214,74,255,0.34);
        }

        body[data-fx-mode='hades'] .cvss-gauge-sub {
            color: rgba(248,229,203,0.74);
            text-shadow: 0 0 12px rgba(255,130,58,0.32);
        }

        body[data-fx-mode='zeus'] .cvss-gauge-value {
            background: linear-gradient(135deg, #eef7ff 0%, #81bdff 50%, #3a72ff 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(84,150,255,0.42);
        }

        body[data-fx-mode='zeus'] .cvss-gauge-sub {
            color: rgba(210, 229, 255, 0.74);
            text-shadow: 0 0 12px rgba(75, 139, 255, 0.30);
        }

        body[data-fx-mode='zeus'] .cvss-gauge-container {
            border-color: rgba(86, 142, 255, 0.40);
            background:
                radial-gradient(760px circle at 50% 8%, rgba(112, 176, 255, 0.18), transparent 60%),
                radial-gradient(620px circle at 50% 92%, rgba(38, 86, 219, 0.24), transparent 60%),
                linear-gradient(160deg, rgba(4, 12, 34, 0.88), rgba(1, 5, 15, 0.90));
            box-shadow:
                inset 0 0 0 1px rgba(212, 234, 255, 0.06),
                0 0 30px rgba(36, 92, 230, 0.32);
        }

        body[data-fx-mode='zeus'] #cvssGauge {
            filter: drop-shadow(0 0 22px rgba(104, 171, 255, 0.36)) drop-shadow(0 0 34px rgba(48, 105, 255, 0.30));
        }

        body[data-fx-mode='helios'] .cvss-gauge-value {
            background: linear-gradient(135deg, #fff2d6 0%, #ffb76f 58%, #ff6f43 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        body[data-fx-mode='zeus'] .myth-btn {
            background: linear-gradient(140deg, rgba(4, 11, 31, 0.95), rgba(5, 22, 60, 0.82));
            border-color: rgba(96, 154, 255, 0.46);
            color: rgba(221, 238, 255, 0.86);
            text-shadow: 0 0 12px rgba(84, 150, 255, 0.24);
        }

        body[data-fx-mode='zeus'] .myth-btn::before {
            background: linear-gradient(118deg, transparent 10%, rgba(121, 183, 255, 0.20) 42%, rgba(74, 123, 255, 0.34) 54%, transparent 88%);
        }

        body[data-fx-mode='zeus'] .myth-btn:hover,
        body[data-fx-mode='zeus'] .myth-btn.active {
            color: #eaf4ff;
            border-color: rgba(158, 208, 255, 0.74);
            background: linear-gradient(135deg, rgba(6, 18, 48, 0.98), rgba(38, 95, 232, 0.86));
            box-shadow:
                0 0 20px rgba(84, 150, 255, 0.44),
                0 0 34px rgba(41, 100, 250, 0.30);
        }

        body[data-fx-mode='zeus'] .myth-btn:hover::after,
        body[data-fx-mode='zeus'] .myth-btn.active::after {
            content: '';
            position: absolute;
            inset: -30% -12%;
            pointer-events: none;
            background: linear-gradient(112deg, transparent 42%, rgba(230,244,255,0.96) 50%, transparent 58%);
            animation: zeusArc 1.7s steps(1, end) infinite;
            mix-blend-mode: screen;
        }

        body[data-fx-mode='zeus'] .chart-container {
            border-color: rgba(94, 148, 255, 0.44);
            background:
                linear-gradient(152deg, rgba(4, 12, 32, 0.94), rgba(1, 5, 14, 0.94) 64%),
                radial-gradient(760px circle at 88% -6%, rgba(122, 186, 255, 0.22), transparent 62%),
                radial-gradient(680px circle at 14% 10%, rgba(32, 88, 235, 0.18), transparent 62%);
            box-shadow:
                inset 0 0 0 1px rgba(224, 238, 255, 0.05),
                0 0 26px rgba(43, 101, 236, 0.28);
        }

        body[data-fx-mode='zeus'] .chart-container::after {
            content: '';
            position: absolute;
            inset: 0;
            pointer-events: none;
            border-radius: inherit;
            background:
                radial-gradient(circle at 14% 12%, rgba(170, 216, 255, 0.28), transparent 56%),
                linear-gradient(120deg, transparent 24%, rgba(166, 214, 255, 0.28) 50%, transparent 76%);
            mix-blend-mode: screen;
            opacity: 0.22;
            animation: zeusChartSurge 5.4s ease-in-out infinite;
        }

        body[data-fx-mode='zeus'] .refresh-btn,
        body[data-fx-mode='zeus'] .clear-btn {
            color: rgba(226, 241, 255, 0.92);
            border-color: rgba(96, 156, 255, 0.44);
            background: linear-gradient(135deg, rgba(6, 14, 35, 0.78), rgba(7, 24, 60, 0.64));
            box-shadow: inset 0 0 0 1px rgba(214, 236, 255, 0.04);
        }

        body[data-fx-mode='zeus'] .refresh-btn:hover,
        body[data-fx-mode='zeus'] .clear-btn:hover {
            color: #f4fbff;
            border-color: rgba(150, 205, 255, 0.68);
            background: linear-gradient(135deg, rgba(10, 30, 76, 0.96), rgba(40, 98, 234, 0.86));
            box-shadow:
                0 0 20px rgba(83, 150, 255, 0.34),
                0 0 30px rgba(35, 96, 245, 0.26);
        }

        .zeus-spark-target {
            position: relative;
        }

        .zeus-touch-spark {
            position: fixed;
            width: 62px;
            height: 62px;
            margin: -31px 0 0 -31px;
            pointer-events: none;
            z-index: 15;
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.32);
            animation: zeusTouchSparkPop 480ms cubic-bezier(0.22, 0.72, 0.2, 1) forwards;
            will-change: transform, opacity;
        }

        .zeus-touch-spark::before {
            content: '';
            position: absolute;
            inset: 10px;
            border-radius: 50%;
            border: 1px solid rgba(176, 223, 255, 0.78);
            box-shadow:
                0 0 10px rgba(148, 206, 255, 0.84),
                0 0 24px rgba(61, 124, 255, 0.64),
                inset 0 0 16px rgba(230, 244, 255, 0.42);
        }

        .zeus-touch-spark::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 50%;
            width: 58px;
            height: 4px;
            background: linear-gradient(90deg, transparent 0%, rgba(238, 249, 255, 0.98) 50%, transparent 100%);
            transform: translate(-50%, -50%) rotate(var(--spark-rot, 0deg)) scaleX(0.3);
            box-shadow:
                0 0 12px rgba(150, 214, 255, 0.88),
                0 0 24px rgba(68, 129, 255, 0.68);
            animation: zeusTouchSparkBolt 420ms ease-out forwards;
        }

        body[data-fx-mode='zeus'] .zeus-spark-target.zeus-hit {
            box-shadow:
                0 0 0 1px rgba(165, 212, 255, 0.26),
                0 0 22px rgba(90, 156, 255, 0.30),
                0 0 34px rgba(43, 101, 240, 0.22);
        }

        @keyframes zeusTouchSparkPop {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(calc(0.30 * var(--spark-scale, 1)));
            }
            24% {
                opacity: 0.96;
                transform: translate(-50%, -50%) scale(calc(1.02 * var(--spark-scale, 1)));
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(calc(1.72 * var(--spark-scale, 1)));
            }
        }

        @keyframes zeusTouchSparkBolt {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) rotate(var(--spark-rot, 0deg)) scaleX(0.32);
            }
            32% {
                opacity: 0.98;
                transform: translate(-50%, -50%) rotate(var(--spark-rot, 0deg)) scaleX(1.06);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) rotate(var(--spark-rot, 0deg)) scaleX(1.54);
            }
        }

        .utility-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .utility-controls .refresh-btn,
        .utility-controls .clear-btn {
            padding: 10px 12px;
            font-size: 11px;
            border-radius: 10px;
            min-width: 128px;
            justify-content: center;
        }

        .threat-globe-panel {
            padding: 18px 20px 22px;
            margin-bottom: 30px;
        }

        .threat-globe-head {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            gap: 12px;
            margin-bottom: 14px;
        }

        .threat-globe-sub {
            font-size: 12px;
            color: var(--text-muted);
            letter-spacing: 0.06em;
            text-transform: uppercase;
            font-family: var(--font-display);
        }

        .threat-globe-shell {
            position: relative;
            min-height: 340px;
            border-radius: 16px;
            border: 1px solid rgba(242,236,221,0.18);
            background:
                radial-gradient(700px circle at 50% 16%, var(--mode-accent-soft), transparent 62%),
                linear-gradient(145deg, rgba(8,8,10,0.72), rgba(10,10,16,0.86));
            overflow: hidden;
        }

        #threatGlobe {
            width: 100%;
            height: 340px;
            display: block;
            cursor: grab;
        }

        #threatGlobe:active {
            cursor: grabbing;
        }

        .chart-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .recent-attacks-scroll {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border-radius: 12px;
        }

        .recent-attacks-scroll .recent-attacks-table {
            min-width: 920px;
        }

        body[data-performance-mode='1'] .glitter-overlay,
        body[data-performance-mode='1'] .orbital-field,
        body[data-performance-mode='1'] .parallax-layer,
        body[data-performance-mode='1'] .fx-ambient-canvas {
            display: none !important;
        }

        body[data-performance-mode='1'] .dashboard-header,
        body[data-performance-mode='1'] .stat-card,
        body[data-performance-mode='1'] .chart-container,
        body[data-performance-mode='1'] .behavioral-section,
        body[data-performance-mode='1'] .behavioral-metric {
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
        }

        body[data-performance-mode='1'] .chart-container::after,
        body[data-performance-mode='1'] .myth-btn::after {
            animation: none !important;
        }

        @media (max-width: 1180px) {
            body {
                padding: 14px;
            }

            .dashboard-header {
                padding: 24px 14px 20px;
                margin-bottom: 24px;
            }

            .dashboard-title {
                font-size: clamp(30px, 4.8vw, 38px);
            }

            .action-buttons {
                position: static;
                margin-top: 16px;
                width: 100%;
                align-items: stretch;
            }

            .myth-controls,
            .utility-controls {
                width: 100%;
            }

            .utility-controls .refresh-btn,
            .utility-controls .clear-btn {
                flex: 1;
                min-width: 0;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
                gap: 14px;
                margin-bottom: 24px;
            }

            .chart-container {
                padding: 16px;
                margin-bottom: 18px;
            }
        }

        @media (max-width: 860px) {
            .myth-controls {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .threat-globe-shell {
                min-height: 280px;
            }

            #threatGlobe {
                height: 280px;
            }

            .recent-attacks-table thead th,
            .recent-attacks-table td {
                white-space: nowrap;
            }
        }

        @media (max-width: 640px) {
            .myth-controls {
                grid-template-columns: 1fr;
            }

            .utility-controls {
                flex-direction: column;
            }

            .utility-controls .refresh-btn,
            .utility-controls .clear-btn {
                width: 100%;
            }

            .stats-grid,
            .behavioral-grid,
            .chart-row {
                grid-template-columns: 1fr;
            }

            .chart-row {
                gap: 16px;
                margin-bottom: 24px;
            }

            .dashboard-subtitle {
                font-size: 12px;
                line-height: 1.4;
            }

            .chart-title,
            .behavioral-title {
                font-size: 14px;
                letter-spacing: 0.04em;
            }

            .cvss-gauge-value {
                font-size: 38px;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            .parallax-layer { display: none; }
            .glitter-overlay,
            .orbital-field { display: none; }
            .tilt-card { transition: none !important; }
            .recent-attacks-table tbody tr.attack-row-new { animation: none !important; }
        }
    </style>
</head>
<body>
    <div class="gradient-overlay" aria-hidden="true"></div>
    <div class="glitter-overlay" aria-hidden="true"></div>
    <div class="orbital-field" aria-hidden="true">
        <svg viewBox="0 0 800 800" class="orbital-svg">
            <circle cx="400" cy="400" r="260" class="orbit-ring" />
            <circle cx="400" cy="400" r="180" class="orbit-ring faint" />
            <circle cx="400" cy="400" r="90" class="orbit-ring faint" />
        </svg>
    </div>
    <div class="parallax-layer layer-a" aria-hidden="true"></div>
    <div class="parallax-layer layer-b" aria-hidden="true"></div>
    <div class="dashboard-halo"></div>

    <div class="dashboard-header">
        <h1 class="dashboard-title">Advanced Honeypot Dashboard</h1>
        <p class="dashboard-subtitle">CVE Detection | CVSS 3.1 Scoring | OWASP Analysis | ML-Powered</p>
        <div class="action-buttons">
            <div class="myth-controls">
                <button class="myth-btn zeus" type="button" data-fx-mode="zeus" onclick="setFxMode('zeus')">Zeus Thunder</button>
                <button class="myth-btn helios" type="button" data-fx-mode="helios" onclick="setFxMode('helios')">Sun God Inferno</button>
                <button class="myth-btn hades" type="button" data-fx-mode="hades" onclick="setFxMode('hades')">Hades Abyss</button>
            </div>
            <div class="utility-controls">
                <button class="refresh-btn" onclick="loadDashboardData()">
                    <span class="loading" id="loadingSpinner" style="display: none;"></span>
                    REFRESH DATA
                </button>
                <button class="clear-btn" onclick="showClearModal()">
                    CLEAR ALL DATA
                </button>
            </div>
        </div>
    </div>

    <div class="chart-container threat-globe-panel">
        <div class="threat-globe-head">
            <h3 class="chart-title">Planetary Attack Theater</h3>
            <p class="threat-globe-sub">Showcase simulation | synthetic cross-nation traffic lanes</p>
        </div>
        <div class="threat-globe-shell">
            <canvas id="threatGlobe"></canvas>
        </div>
    </div>

    <!-- Statistics Grid -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">Total Attacks</div>
            <div class="stat-value" id="totalAttacks">0</div>
            <div class="stat-meta">All time</div>
        </div>
        <div class="stat-card critical">
            <div class="stat-label">Critical</div>
            <div class="stat-value" id="criticalCount">0</div>
            <div class="stat-meta">CVSS 9.0 - 10.0</div>
        </div>
        <div class="stat-card high">
            <div class="stat-label">High</div>
            <div class="stat-value" id="highCount">0</div>
            <div class="stat-meta">CVSS 7.0 - 8.9</div>
        </div>
        <div class="stat-card medium">
            <div class="stat-label">Medium</div>
            <div class="stat-value" id="mediumCount">0</div>
            <div class="stat-meta">CVSS 4.0 - 6.9</div>
        </div>
        <div class="stat-card low">
            <div class="stat-label">Low</div>
            <div class="stat-value" id="lowCount">0</div>
            <div class="stat-meta">CVSS 0.1 - 3.9</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Avg CVSS Score</div>
            <div class="stat-value" id="avgCvss">0.0</div>
            <div class="stat-meta">Base Score</div>
        </div>
    </div>

    <!-- Behavioral Metrics Section (NEW!) -->
    <div class="behavioral-section">
        <div class="behavioral-title">
            Behavioral Tracking Metrics (Honeypot Features)
        </div>
        <div class="behavioral-grid">
            <div class="behavioral-metric">
                <div class="behavioral-metric-label">Avg Mouse Movements</div>
                <div class="behavioral-metric-value" id="avgMouse">0</div>
                <div class="behavioral-metric-range">Bot: 0-5 | Human: 50-500</div>
            </div>
            <div class="behavioral-metric">
                <div class="behavioral-metric-label">Avg Keystrokes</div>
                <div class="behavioral-metric-value" id="avgKeystrokes">0</div>
                <div class="behavioral-metric-range">Bot: 0-10 | Human: 20-100</div>
            </div>
            <div class="behavioral-metric">
                <div class="behavioral-metric-label">Avg Time to Submit</div>
                <div class="behavioral-metric-value" id="avgTime">0.0s</div>
                <div class="behavioral-metric-range">Bot: <3s | Human: >5s</div>
            </div>
            <div class="behavioral-metric">
                <div class="behavioral-metric-label">Paste Events</div>
                <div class="behavioral-metric-value" id="totalPaste">0</div>
                <div class="behavioral-metric-range">Indicates copy-paste attacks</div>
            </div>
            <div class="behavioral-metric">
                <div class="behavioral-metric-label">Honeypot Fields Filled</div>
                <div class="behavioral-metric-value" id="honeypotFilled">0</div>
                <div class="behavioral-metric-range">Only bots fill these</div>
            </div>
            <div class="behavioral-metric">
                <div class="behavioral-metric-label">Rapid Submissions</div>
                <div class="behavioral-metric-value" id="rapidSubmissions">0</div>
                <div class="behavioral-metric-range">Submitted in <3 seconds</div>
            </div>
        </div>
    </div>

    <!-- CVSS Gauge -->
    <div class="chart-container">
        <h3 class="chart-title">CVSS 3.1 Average Base Score</h3>
        <div class="cvss-gauge-container">
            <canvas id="cvssGauge"></canvas>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="chart-row">
        <div class="chart-container">
            <h3 class="chart-title">Vulnerability Type Distribution</h3>
            <canvas id="vulnChart"></canvas>
        </div>
        <div class="chart-container">
            <h3 class="chart-title">Severity Distribution</h3>
            <canvas id="severityChart"></canvas>
        </div>
    </div>

    <!-- OWASP Top 10 -->
    <div class="chart-container">
        <h3 class="chart-title">OWASP Top 10 Detection</h3>
        <ul class="owasp-list" id="owaspList"></ul>
    </div>

    <!-- Top CVE References -->
    <div class="chart-container">
        <h3 class="chart-title">Top CVE References</h3>
        <canvas id="cveChart"></canvas>
    </div>

    <!-- Recent Attacks Table -->
    <div class="chart-container">
        <h3 class="chart-title">Recent Attack Details</h3>
        <div class="recent-attacks-scroll">
            <table class="recent-attacks-table" id="recentAttacksTable">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Session ID</th>
                        <th>Severity</th>
                        <th>CVSS</th>
                        <th>Attack Type</th>
                        <th>CVE Reference</th>
                        <th>OWASP Category</th>
                    </tr>
                </thead>
                <tbody id="recentAttacksBody">
                    <tr>
                        <td colspan="7" style="text-align: center; color: rgba(242, 236, 221, 0.4);">
                            No attacks detected yet
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- AI Analysis Panel -->
    <div class="chart-container">
        <h3 class="chart-title">AI Threat Brief (Reveal)</h3>
        <div class="ai-panel">
            <div class="ai-meta" id="aiMeta">
                <span class="ai-pill">Select an attack to analyze</span>
            </div>
            <div class="ai-text" id="aiAnalysisText">Waiting for an event...</div>
        </div>
    </div>

    <!-- Clear Confirmation Modal -->
    <div id="clearModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-title">Warning: Clear All Data</h2>
            <p class="modal-text">
                Are you sure you want to delete ALL attack logs?<br>
                This will permanently remove all data from the server.<br><br>
                <strong>This action cannot be undone!</strong>
            </p>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-confirm" onclick="confirmClearData()">
                    Yes, Clear All Data
                </button>
                <button class="modal-btn modal-btn-cancel" onclick="hideClearModal()">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <script src="dashboard-effects.js"></script>
    <script>
        // Configuration
        const API_ENDPOINT = 'https://honeypot-backend-9c81.onrender.com/api/stats';
        const CLEAR_ENDPOINT = 'https://honeypot-backend-9c81.onrender.com/api/clear';
        const ANALYZE_ENDPOINT = API_ENDPOINT.replace(/\/api\/stats\/?$/, '/api/analyze');

        const prefersReducedMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        const supportsFinePointer = window.matchMedia && window.matchMedia('(hover: hover) and (pointer: fine)').matches;
        const isCompactViewport = window.matchMedia && window.matchMedia('(max-width: 960px)').matches;
        const isLowCoreDevice = typeof navigator.hardwareConcurrency === 'number' && navigator.hardwareConcurrency > 0 && navigator.hardwareConcurrency <= 8;
        const isPerformanceMode = !!(prefersReducedMotion || isCompactViewport || isLowCoreDevice);
        const zeusSparkTargetSelector = '.myth-btn, .refresh-btn, .clear-btn, .cvss-gauge-container, .chart-container';
        
        let vulnChart, severityChart, cveChart, cvssGauge;
        let hasLoadedOnce = false;
        const seenAttackKeys = new Set();
        const seenAttackKeyQueue = [];
        const MAX_SEEN_ATTACK_KEYS = 600;
        let selectedAttackKey = null;
        let analyzeAbortController = null;
        let currentFxMode = 'hades';
        let isDashboardLoading = false;
        let pendingDashboardReload = false;
        let zeusSparkBurstCount = 0;
        let zeusSparkWindowStart = 0;

        function normalizeFxMode(mode) {
            const v = String(mode || '').toLowerCase();
            if (v === 'gaia') return 'hades';
            return ['zeus', 'helios', 'hades'].includes(v) ? v : 'hades';
        }

        function setFxMode(mode, skipThemeApply = false) {
            currentFxMode = normalizeFxMode(mode);
            document.querySelectorAll('.myth-btn[data-fx-mode]').forEach((btn) => {
                const btnMode = normalizeFxMode(btn.getAttribute('data-fx-mode'));
                btn.classList.toggle('active', btnMode === currentFxMode);
            });

            if (window.DashboardEffects && typeof window.DashboardEffects.setMode === 'function') {
                window.DashboardEffects.setMode(currentFxMode);
            } else {
                document.body.setAttribute('data-fx-mode', currentFxMode);
            }

            if (!skipThemeApply && window.DashboardEffects && typeof window.DashboardEffects.applyChartTheme === 'function' && vulnChart && severityChart && cveChart) {
                window.DashboardEffects.applyChartTheme({ vulnChart, severityChart, cveChart }, currentFxMode);
            }
        }

        function clamp(n, min, max) {
            return Math.min(max, Math.max(min, n));
        }

        // Depth-based parallax scroll: update fixed background layers without touching UI transforms.
        function initParallaxScroll() {
            if (isPerformanceMode) return;
            const layerA = document.querySelector('.parallax-layer.layer-a');
            const layerB = document.querySelector('.parallax-layer.layer-b');
            if (!layerA || !layerB) return;

            let raf = 0;
            const update = () => {
                raf = 0;
                const y = window.scrollY || 0;
                layerA.style.transform = `translate3d(0, ${-y * 0.10}px, 0)`;
                layerB.style.transform = `translate3d(0, ${-y * 0.18}px, 0)`;
            };

            const onScroll = () => {
                if (raf) return;
                raf = requestAnimationFrame(update);
            };

            update();
            window.addEventListener('scroll', onScroll, { passive: true });
        }

        // Spatial mouse tilt tracking for cards/containers.
        function initTiltTracking() {
            if (isPerformanceMode || !supportsFinePointer) return;

            const targets = [
                ...document.querySelectorAll('.stat-card'),
                ...document.querySelectorAll('.behavioral-metric'),
                ...document.querySelectorAll('.chart-container'),
            ];

            targets.forEach((el) => {
                el.classList.add('tilt-card');
                let rect = null;

                const onEnter = () => {
                    rect = el.getBoundingClientRect();
                    el.classList.add('tilt-active');
                };

                const onMove = (e) => {
                    if (!rect) rect = el.getBoundingClientRect();
                    const px = (e.clientX - rect.left) / rect.width;
                    const py = (e.clientY - rect.top) / rect.height;
                    const clampedX = clamp(px, 0, 1);
                    const clampedY = clamp(py, 0, 1);

                    const maxTilt = el.classList.contains('stat-card') ? 8 : 5;
                    const rx = (0.5 - clampedY) * maxTilt;
                    const ry = (clampedX - 0.5) * maxTilt;

                    el.style.setProperty('--rx', rx.toFixed(2) + 'deg');
                    el.style.setProperty('--ry', ry.toFixed(2) + 'deg');
                    el.style.setProperty('--mx', (clampedX * 100).toFixed(1) + '%');
                    el.style.setProperty('--my', (clampedY * 100).toFixed(1) + '%');
                };

                const onLeave = () => {
                    el.classList.remove('tilt-active');
                    el.style.removeProperty('--rx');
                    el.style.removeProperty('--ry');
                    el.style.removeProperty('--mx');
                    el.style.removeProperty('--my');
                    rect = null;
                };

                el.addEventListener('pointerenter', onEnter);
                el.addEventListener('pointermove', onMove);
                el.addEventListener('pointerleave', onLeave);
            });
        }

        function canEmitZeusSpark(now) {
            if (prefersReducedMotion) return false;
            const windowMs = 900;
            const maxBursts = isPerformanceMode ? 3 : 8;
            if ((now - zeusSparkWindowStart) > windowMs) {
                zeusSparkWindowStart = now;
                zeusSparkBurstCount = 0;
            }
            if (zeusSparkBurstCount >= maxBursts) return false;
            zeusSparkBurstCount += 1;
            return true;
        }

        function flashZeusTarget(target) {
            if (!target || !target.classList) return;
            target.classList.remove('zeus-hit');
            void target.offsetWidth;
            target.classList.add('zeus-hit');
            window.setTimeout(() => target.classList.remove('zeus-hit'), 280);
        }

        function spawnZeusSpark(clientX, clientY, target) {
            if (currentFxMode !== 'zeus') return;
            const now = performance.now();
            if (!canEmitZeusSpark(now)) return;

            const spark = document.createElement('span');
            spark.className = 'zeus-touch-spark';
            spark.style.left = `${Math.round(clientX)}px`;
            spark.style.top = `${Math.round(clientY)}px`;
            spark.style.setProperty('--spark-rot', `${Math.floor(Math.random() * 360)}deg`);
            spark.style.setProperty('--spark-scale', (isPerformanceMode ? (0.86 + Math.random() * 0.20) : (0.92 + Math.random() * 0.42)).toFixed(2));
            document.body.appendChild(spark);

            const removeSpark = () => spark.remove();
            spark.addEventListener('animationend', removeSpark, { once: true });
            window.setTimeout(removeSpark, 540);
            flashZeusTarget(target);
        }

        function initZeusTouchSparks() {
            const targets = Array.from(document.querySelectorAll(zeusSparkTargetSelector));
            if (!targets.length) return;
            targets.forEach((el) => el.classList.add('zeus-spark-target'));

            document.addEventListener('pointerdown', (e) => {
                if (e.pointerType === 'mouse' && e.button !== 0) return;
                const source = e.target instanceof Element ? e.target.closest('.zeus-spark-target') : null;
                if (!source) return;

                const rect = source.getBoundingClientRect();
                const x = Number.isFinite(e.clientX) ? e.clientX : rect.left + (rect.width / 2);
                const y = Number.isFinite(e.clientY) ? e.clientY : rect.top + (rect.height / 2);
                spawnZeusSpark(x, y, source);
            }, { passive: true });

            document.addEventListener('keydown', (e) => {
                if (e.key !== 'Enter' && e.key !== ' ') return;
                const active = document.activeElement instanceof Element ? document.activeElement.closest('.zeus-spark-target') : null;
                if (!active) return;
                const rect = active.getBoundingClientRect();
                spawnZeusSpark(rect.left + rect.width / 2, rect.top + rect.height / 2, active);
            });
        }

        function initializeAiPanel() {
            const aiText = document.getElementById('aiAnalysisText');
            if (aiText) aiText.textContent = 'Waiting for an event...';
        }

        function ensureCvssGaugeOverlay(canvas) {
            if (!canvas) return null;
            const container = canvas.closest('.cvss-gauge-container');
            if (!container) return null;

            let overlay = container.querySelector('.cvss-gauge-overlay');
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.className = 'cvss-gauge-overlay';
                overlay.innerHTML = `
                    <div style="display:flex; flex-direction:column; align-items:center;">
                        <div class="cvss-gauge-value" id="cvssGaugeValue">0.0</div>
                        <div class="cvss-gauge-sub">AVG CVSS</div>
                    </div>
                `;
                container.appendChild(overlay);
            }

            return overlay.querySelector('#cvssGaugeValue');
        }

        function createCvssRadialGauge(canvas) {
            if (window.DashboardEffects && typeof window.DashboardEffects.createLiquidCvssGauge === 'function') {
                const liquidGauge = window.DashboardEffects.createLiquidCvssGauge(canvas, { prefersReducedMotion });
                if (liquidGauge && typeof liquidGauge.setValue === 'function') {
                    return liquidGauge;
                }
            }

            const valueEl = ensureCvssGaugeOverlay(canvas);
            const setLabel = (v) => {
                if (!valueEl) return;
                valueEl.textContent = Number.isFinite(v) ? v.toFixed(1) : '0.0';
            };

            if (!canvas) return { setValue: () => {} };

            // Try WebGL first (preferred).
            const gl = canvas.getContext('webgl2', { alpha: true, antialias: true, premultipliedAlpha: true })
                || canvas.getContext('webgl', { alpha: true, antialias: true, premultipliedAlpha: true });

            const fallback2d = () => {
                const ctx2d = canvas.getContext('2d');
                const render = (valueNorm) => {
                    if (!ctx2d) return;
                    const dpr = Math.max(1, Math.min(2.5, window.devicePixelRatio || 1));
                    const rect = canvas.getBoundingClientRect();
                    const w = Math.max(1, Math.floor(rect.width * dpr));
                    const h = Math.max(1, Math.floor(rect.height * dpr));
                    if (canvas.width !== w || canvas.height !== h) {
                        canvas.width = w;
                        canvas.height = h;
                    }

                    const cx = w / 2;
                    const cy = h / 2;
                    const r = Math.min(w, h) * 0.34;
                    const start = -Math.PI / 2;
                    const end = start + Math.PI * 2 * valueNorm;

                    ctx2d.clearRect(0, 0, w, h);
                    ctx2d.lineCap = 'round';
                    ctx2d.lineWidth = Math.max(10, Math.min(18, r * 0.22));

                    // Track (inactive)
                    ctx2d.strokeStyle = 'rgba(242, 236, 221, 0.12)';
                    ctx2d.beginPath();
                    ctx2d.arc(cx, cy, r, 0, Math.PI * 2);
                    ctx2d.stroke();

                    // Active gradient
                    const grad = ctx2d.createLinearGradient(0, 0, w, h);
                    grad.addColorStop(0, 'rgba(30,168,150,0.95)');
                    grad.addColorStop(0.55, 'rgba(199,150,28,0.95)');
                    grad.addColorStop(1, 'rgba(177,18,18,0.95)');
                    ctx2d.strokeStyle = grad;
                    ctx2d.beginPath();
                    ctx2d.arc(cx, cy, r, start, end);
                    ctx2d.stroke();
                };

                return {
                    setValue(v) {
                        const clamped = clamp(Number(v) || 0, 0, 10);
                        setLabel(clamped);
                        render(clamped / 10);
                    }
                };
            };

            if (!gl) return fallback2d();

            // WebGL implementation: full-screen triangles + fragment shader ring.
            const vsSource = `
                attribute vec2 a_pos;
                varying vec2 v_uv;
                void main() {
                    v_uv = (a_pos + 1.0) * 0.5;
                    gl_Position = vec4(a_pos, 0.0, 1.0);
                }
            `;

            const fsSource = `
                precision highp float;
                varying vec2 v_uv;
                uniform vec2 u_res;
                uniform float u_value;   // 0..1
                uniform float u_time;

                float sat(float x) { return clamp(x, 0.0, 1.0); }

                vec3 heat(float t) {
                    // teal -> gold -> red
                    vec3 a = vec3(0.117, 0.659, 0.588);
                    vec3 b = vec3(0.780, 0.588, 0.110);
                    vec3 c = vec3(0.694, 0.071, 0.071);
                    float m = smoothstep(0.0, 1.0, t);
                    vec3 ab = mix(a, b, smoothstep(0.0, 0.60, m));
                    return mix(ab, c, smoothstep(0.60, 1.0, m));
                }

                void main() {
                    vec2 p = (gl_FragCoord.xy - 0.5 * u_res) / min(u_res.x, u_res.y);
                    float r = length(p);
                    float a = atan(p.y, p.x);
                    float t = fract(a / (6.28318530718) + 0.25); // start at top

                    float outer = 0.46;
                    float inner = 0.32;
                    float ring = smoothstep(outer, outer - 0.008, r) * smoothstep(inner, inner + 0.008, r);

                    float active = step(t, u_value) * ring;
                    float inactive = (1.0 - step(t, u_value)) * ring;

                    // Head glow at current value.
                    float head = exp(-pow((t - u_value) * 140.0, 2.0)) * ring;

                    vec3 colActive = heat(t);
                    vec3 colInactive = vec3(0.95) * 0.10;

                    float flicker = 0.015 * sin(u_time * 2.6 + t * 18.0);
                    vec3 col = active * (colActive + flicker) + inactive * colInactive;

                    // Subtle inner bloom
                    float bloom = pow(sat(1.0 - abs(r - (inner + outer) * 0.5) / ((outer - inner) * 0.5)), 2.2);
                    col += active * colActive * 0.18 * bloom;
                    col += head * vec3(1.0, 0.92, 0.75) * 0.85;

                    float alpha = ring * 0.92;
                    alpha *= sat(1.0 - r * 1.35);
                    gl_FragColor = vec4(col, alpha);
                }
            `;

            function compileShader(type, source) {
                const sh = gl.createShader(type);
                gl.shaderSource(sh, source);
                gl.compileShader(sh);
                if (!gl.getShaderParameter(sh, gl.COMPILE_STATUS)) {
                    const log = gl.getShaderInfoLog(sh) || '';
                    gl.deleteShader(sh);
                    throw new Error(log);
                }
                return sh;
            }

            function createProgram(vs, fs) {
                const prog = gl.createProgram();
                gl.attachShader(prog, vs);
                gl.attachShader(prog, fs);
                gl.linkProgram(prog);
                if (!gl.getProgramParameter(prog, gl.LINK_STATUS)) {
                    const log = gl.getProgramInfoLog(prog) || '';
                    gl.deleteProgram(prog);
                    throw new Error(log);
                }
                return prog;
            }

            let program = null;
            let buffer = null;
            let aPosLoc = -1;
            let uResLoc = null;
            let uValueLoc = null;
            let uTimeLoc = null;

            try {
                const vs = compileShader(gl.VERTEX_SHADER, vsSource);
                const fs = compileShader(gl.FRAGMENT_SHADER, fsSource);
                program = createProgram(vs, fs);
                gl.deleteShader(vs);
                gl.deleteShader(fs);
            } catch (e) {
                console.warn('CVSS WebGL gauge init failed, falling back to 2D.', e);
                return fallback2d();
            }

            buffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
                -1, -1,
                1, -1,
                -1,  1,
                -1,  1,
                1, -1,
                1,  1
            ]), gl.STATIC_DRAW);

            gl.useProgram(program);
            aPosLoc = gl.getAttribLocation(program, 'a_pos');
            uResLoc = gl.getUniformLocation(program, 'u_res');
            uValueLoc = gl.getUniformLocation(program, 'u_value');
            uTimeLoc = gl.getUniformLocation(program, 'u_time');

            let current = 0.0;
            let target = 0.0;
            let running = true;
            let lastTime = performance.now();

            function resize() {
                const dpr = Math.max(1, Math.min(2.5, window.devicePixelRatio || 1));
                const rect = canvas.getBoundingClientRect();
                const w = Math.max(1, Math.floor(rect.width * dpr));
                const h = Math.max(1, Math.floor(rect.height * dpr));
                if (canvas.width !== w || canvas.height !== h) {
                    canvas.width = w;
                    canvas.height = h;
                    gl.viewport(0, 0, w, h);
                }
            }

            function draw(now) {
                if (!running) return;
                resize();
                const dt = Math.min(0.05, Math.max(0.0, (now - lastTime) / 1000));
                lastTime = now;

                const k = prefersReducedMotion ? 1.0 : (1.0 - Math.pow(0.0008, dt));
                current = current + (target - current) * k;

                gl.useProgram(program);
                gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
                gl.enableVertexAttribArray(aPosLoc);
                gl.vertexAttribPointer(aPosLoc, 2, gl.FLOAT, false, 0, 0);

                gl.uniform2f(uResLoc, canvas.width, canvas.height);
                gl.uniform1f(uValueLoc, clamp(current, 0.0, 1.0));
                gl.uniform1f(uTimeLoc, now / 1000);

                gl.clearColor(0, 0, 0, 0);
                gl.clear(gl.COLOR_BUFFER_BIT);
                gl.drawArrays(gl.TRIANGLES, 0, 6);

                requestAnimationFrame(draw);
            }

            window.addEventListener('resize', resize);
            resize();
            requestAnimationFrame(draw);

            return {
                setValue(v) {
                    const clamped = clamp(Number(v) || 0, 0, 10);
                    setLabel(clamped);
                    target = clamped / 10;
                }
            };
        }

        function makeAttackKey(attack) {
            const ts = attack && attack.timestamp ? String(attack.timestamp) : '';
            const sid = attack && attack.session_id ? String(attack.session_id) : '';
            return `${ts}::${sid}`;
        }

        function rememberAttackKey(key) {
            if (!key || seenAttackKeys.has(key)) return;
            seenAttackKeys.add(key);
            seenAttackKeyQueue.push(key);
            if (seenAttackKeyQueue.length > MAX_SEEN_ATTACK_KEYS) {
                const evict = seenAttackKeyQueue.shift();
                if (evict) seenAttackKeys.delete(evict);
            }
        }

        function showLiveToast(title, body) {
            if (isPerformanceMode) return;
            const toast = document.createElement('div');
            toast.className = 'live-toast';
            toast.innerHTML = `
                <div class="live-toast-title">${title}</div>
                <div class="live-toast-body">${body}</div>
            `;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'liveToastOut 220ms ease-in';
                setTimeout(() => toast.remove(), 240);
            }, 2600);
        }

        function revealText(el, text, duration = 900) {
            if (!el) return;
            const original = String(text || '');
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789:/.-_[]{}()<>+=*#@';
            const start = performance.now();

            if (isPerformanceMode) {
                el.textContent = original;
                return;
            }

            const tick = (now) => {
                const t = clamp((now - start) / duration, 0, 1);
                const revealCount = Math.floor(t * original.length);
                let out = '';
                for (let i = 0; i < original.length; i += 1) {
                    const ch = original[i];
                    if (ch === '\n' || ch === '\r' || ch === '\t' || ch === ' ') {
                        out += ch;
                        continue;
                    }
                    if (i < revealCount) out += ch;
                    else out += chars[Math.floor(Math.random() * chars.length)];
                }
                el.textContent = out;
                if (t < 1) requestAnimationFrame(tick);
                else el.textContent = original;
            };

            requestAnimationFrame(tick);
        }

        function localFallbackAnalysis(attack) {
            const sev = attack && attack.severity ? attack.severity : 'UNKNOWN';
            const cvss = Number(attack && attack.cvss_score ? attack.cvss_score : 0);
            const type = attack && attack.attack_type ? attack.attack_type : 'unknown';
            const cve = attack && attack.cve ? `Primary CVE reference: ${attack.cve}` : 'No CVE reference available.';
            const owasp = attack && attack.owasp ? `OWASP mapping: ${attack.owasp}` : 'OWASP mapping unavailable.';

            const severityHint =
                sev === 'CRITICAL' ? 'Immediate response recommended: isolate affected surface, rotate secrets, and validate patch coverage.'
                : sev === 'HIGH' ? 'Prioritize triage: validate exploitability, confirm exposure, and apply mitigations.'
                : sev === 'MEDIUM' ? 'Investigate and reduce attack surface: harden input validation and add detection rules.'
                : 'Monitor and correlate with other signals before escalating.';

            return [
                `Event classified as ${sev} (${cvss.toFixed(1)} CVSS).`,
                `Likely technique: ${type}.`,
                cve,
                owasp,
                '',
                severityHint,
            ].join('\n');
        }

        async function analyzeAttack(attack) {
            const aiText = document.getElementById('aiAnalysisText');
            const aiMeta = document.getElementById('aiMeta');
            if (!aiText || !aiMeta) return;

            const ts = attack && attack.timestamp ? new Date(attack.timestamp).toLocaleString() : 'Unknown time';
            const sidFull = attack && attack.session_id ? String(attack.session_id) : 'unknown';
            const sid = sidFull.length > 18 ? sidFull.slice(0, 18) + '...' : sidFull;
            const sev = attack && attack.severity ? attack.severity : 'UNKNOWN';
            const cvss = Number(attack && attack.cvss_score ? attack.cvss_score : 0);
            const type = attack && attack.attack_type ? attack.attack_type : 'unknown';

            aiMeta.innerHTML = `
                <span class="ai-pill">Session: ${sid}</span>
                <span class="ai-pill">Severity: ${sev}</span>
                <span class="ai-pill">CVSS: ${Number.isFinite(cvss) ? cvss.toFixed(1) : '0.0'}</span>
                <span class="ai-pill">Type: ${type}</span>
                <span class="ai-pill">Time: ${ts}</span>
            `;

            aiText.textContent = 'Analyzing...';

            if (analyzeAbortController) analyzeAbortController.abort();
            analyzeAbortController = new AbortController();

            const payload = {
                threat_keyword: (attack && (attack.attack_type || attack.cve || attack.owasp)) ? (attack.attack_type || attack.cve || attack.owasp) : '',
                payload: [
                    attack && attack.attack_type ? String(attack.attack_type) : '',
                    attack && attack.cve ? String(attack.cve) : '',
                    attack && attack.owasp ? String(attack.owasp) : '',
                ].filter(Boolean).join(' '),
                attack_type: type,
                severity: sev,
                cvss_score: Number.isFinite(cvss) ? cvss : 0,
                cvss_vector: '',
                owasp: attack && attack.owasp ? String(attack.owasp) : '',
                cve: attack && attack.cve ? String(attack.cve) : '',
                cve_references: attack && attack.cve ? [String(attack.cve)] : [],
                session_id: sidFull,
                timestamp: attack && attack.timestamp ? String(attack.timestamp) : '',
                network_features: Array(11).fill(0),
            };

            try {
                const response = await fetch(ANALYZE_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                    signal: analyzeAbortController.signal,
                });

                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const data = await response.json();
                const analysis = (data && typeof data.ai_analysis === 'string' && data.ai_analysis.trim())
                    ? data.ai_analysis
                    : localFallbackAnalysis(attack);

                revealText(aiText, analysis, 1100);
            } catch (e) {
                revealText(aiText, localFallbackAnalysis(attack), 900);
            }
        }

        // Smooth counter animation function
        function animateCounter(id, target) {
            const el = document.getElementById(id);
            if (!el) return;
            if (isPerformanceMode) {
                el.textContent = target;
                return;
            }

            let start = 0;
            const duration = 800;
            const step = target / (duration / 16);

            function update() {
                start += step;
                if (start < target) {
                    el.textContent = Math.floor(start);
                    requestAnimationFrame(update);
                } else {
                    el.textContent = target;
                }
            }
            update();
        }

        document.addEventListener('DOMContentLoaded', () => {
            if (isPerformanceMode) {
                document.body.setAttribute('data-performance-mode', '1');
            }
            setFxMode(currentFxMode, true);
            if (window.DashboardEffects && typeof window.DashboardEffects.boot === 'function') {
                window.DashboardEffects.boot({ prefersReducedMotion: isPerformanceMode, mode: currentFxMode });
            }
            if (window.DashboardEffects && typeof window.DashboardEffects.initThreatGlobe === 'function') {
                window.DashboardEffects.initThreatGlobe(document.getElementById('threatGlobe'), { mode: currentFxMode });
            }
            if (!isPerformanceMode) {
                initParallaxScroll();
                initTiltTracking();
            }
            initZeusTouchSparks();
            initializeCharts();
            initializeAiPanel();
            loadDashboardData();
            setInterval(loadDashboardData, 30000); // Auto-refresh every 30s
        });

        function initializeCharts() {
            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                animation: isPerformanceMode ? false : { duration: 420, easing: 'easeOutCubic' },
                plugins: {
                    legend: {
                        labels: {
                            color: 'rgba(242, 236, 221, 0.8)',
                            font: { size: 12 }
                        }
                    }
                }
            };

            // Vulnerability Chart
            vulnChart = new Chart(document.getElementById('vulnChart'), {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Attacks',
                        data: [],
                        backgroundColor: 'rgba(199, 150, 28, 0.8)',
                        borderColor: 'rgba(199, 150, 28, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    ...chartOptions,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: 'rgba(242, 236, 221, 0.6)' },
                            grid: { color: 'rgba(242, 236, 221, 0.1)' }
                        },
                        x: {
                            ticks: { color: 'rgba(242, 236, 221, 0.6)' },
                            grid: { color: 'rgba(242, 236, 221, 0.1)' }
                        }
                    }
                }
            });

            // Severity Chart (Pie)
            severityChart = new Chart(document.getElementById('severityChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Critical', 'High', 'Medium', 'Low'],
                    datasets: [{
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            'rgba(177, 18, 18, 0.8)',
                            'rgba(255, 107, 53, 0.8)',
                            'rgba(199, 150, 28, 0.8)',
                            'rgba(30, 168, 150, 0.8)'
                        ],
                        borderWidth: 0
                    }]
                },
                options: chartOptions
            });

            // CVE Chart
            cveChart = new Chart(document.getElementById('cveChart'), {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Occurrences',
                        data: [],
                        backgroundColor: 'rgba(177, 18, 18, 0.8)',
                        borderColor: 'rgba(177, 18, 18, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    ...chartOptions,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: { color: 'rgba(242, 236, 221, 0.6)' },
                            grid: { color: 'rgba(242, 236, 221, 0.1)' }
                        },
                        y: {
                            ticks: { color: 'rgba(242, 236, 221, 0.6)' },
                            grid: { color: 'rgba(242, 236, 221, 0.1)' }
                        }
                    }
                }
            });

            // CVSS Gauge (WebGL radial gauge + fallback)
            cvssGauge = createCvssRadialGauge(document.getElementById('cvssGauge'));

            if (window.DashboardEffects && typeof window.DashboardEffects.applyChartTheme === 'function') {
                window.DashboardEffects.applyChartTheme({ vulnChart, severityChart, cveChart }, currentFxMode);
            }
        }

        async function loadDashboardData() {
            const spinner = document.getElementById('loadingSpinner');
            if (isDashboardLoading) {
                pendingDashboardReload = true;
                return;
            }

            isDashboardLoading = true;
            if (spinner) spinner.style.display = 'inline-block';
            
            try {
                const response = await fetch(API_ENDPOINT);
                const data = await response.json();

                // Update statistics with animated counters
                animateCounter('totalAttacks', data.total_attacks || 0);
                document.getElementById('avgCvss').textContent = (data.avg_cvss_score || 0).toFixed(1);

                // Update severity counts with animated counters
                const severity = data.severity_distribution || {};
                animateCounter('criticalCount', severity.CRITICAL || 0);
                animateCounter('highCount', severity.HIGH || 0);
                animateCounter('mediumCount', severity.MEDIUM || 0);
                animateCounter('lowCount', severity.LOW || 0);

                // Update behavioral metrics (NEW!)
                const behavioral = data.behavioral_metrics || {};
                document.getElementById('avgMouse').textContent = Math.round(behavioral.avg_mouse_movements || 0);
                document.getElementById('avgKeystrokes').textContent = Math.round(behavioral.avg_keystrokes || 0);
                document.getElementById('avgTime').textContent = (behavioral.avg_time_to_submit || 0).toFixed(1) + 's';
                document.getElementById('totalPaste').textContent = behavioral.total_paste_events || 0;
                document.getElementById('honeypotFilled').textContent = behavioral.honeypot_filled_count || 0;
                document.getElementById('rapidSubmissions').textContent = behavioral.rapid_submissions_count || 0;

                // Update CVSS Gauge
                const avgCvss = data.avg_cvss_score || 0;
                cvssGauge.setValue(avgCvss);

                // Update Vulnerability Chart
                const vulnDist = data.vulnerability_distribution || {};
                vulnChart.data.labels = Object.keys(vulnDist);
                vulnChart.data.datasets[0].data = Object.values(vulnDist);
                vulnChart.update('none');

                // Update Severity Chart
                severityChart.data.datasets[0].data = [
                    severity.CRITICAL || 0,
                    severity.HIGH || 0,
                    severity.MEDIUM || 0,
                    severity.LOW || 0
                ];
                severityChart.update('none');

                // Update CVE Chart
                const topCves = data.top_cves || [];
                cveChart.data.labels = topCves.map(c => c.cve);
                cveChart.data.datasets[0].data = topCves.map(c => c.count);
                cveChart.update('none');

                // Update OWASP List
                const owaspList = document.getElementById('owaspList');
                const owasp = data.owasp_top_10 || {};
                owaspList.innerHTML = Object.entries(owasp).map(([category, count]) => `
                    <li class="owasp-item">
                        <div class="owasp-category">${category}</div>
                        <div class="owasp-count">${count} attacks</div>
                    </li>
                `).join('') || '<li style="color: rgba(242, 236, 221, 0.4); text-align: center;">No OWASP data yet</li>';

                // Update Recent Attacks Table
                const recentBody = document.getElementById('recentAttacksBody');
                const recent = data.recent_attacks || [];
                if (window.DashboardEffects && typeof window.DashboardEffects.updateThreatFeed === 'function') {
                    window.DashboardEffects.updateThreatFeed(recent, data);
                }
                if (recent.length > 0) {
                    const top = recent.slice(0, 10);
                    const newKeys = new Set();

                    if (hasLoadedOnce) {
                        for (const attack of top) {
                            const k = makeAttackKey(attack);
                            if (k && !seenAttackKeys.has(k)) newKeys.add(k);
                        }
                    }

                    for (const attack of recent) {
                        rememberAttackKey(makeAttackKey(attack));
                    }
                    hasLoadedOnce = true;

                    recentBody.innerHTML = top.map(attack => {
                        const key = makeAttackKey(attack);
                        const isNew = newKeys.has(key);
                        const isSelected = selectedAttackKey && selectedAttackKey === key;
                        const rowClass = [
                            isNew ? 'attack-row-new' : '',
                            isSelected ? 'attack-row-selected' : '',
                        ].filter(Boolean).join(' ');

                        const sev = (attack.severity || '').toLowerCase();
                        const cvss = Number(attack.cvss_score || 0);
                        const ts = attack.timestamp ? new Date(attack.timestamp).toLocaleString() : '-';
                        const cveCell = attack.cve
                            ? `<a href="https://nvd.nist.gov/vuln/detail/${attack.cve}" target="_blank" class="cve-link">${attack.cve}</a>`
                            : '-';

                        return `
                            <tr class="${rowClass}" data-attack-key="${key}"
                                data-ts="${attack.timestamp || ''}"
                                data-session="${attack.session_id || ''}"
                                data-severity="${attack.severity || ''}"
                                data-cvss="${Number.isFinite(cvss) ? cvss : 0}"
                                data-type="${attack.attack_type || ''}"
                                data-cve="${attack.cve || ''}"
                                data-owasp="${attack.owasp || ''}">
                                <td>${ts}</td>
                                <td><code style="font-size: 11px;">${attack.session_id}</code></td>
                                <td><span class="severity-badge ${sev}">${attack.severity}</span></td>
                                <td><strong>${Number.isFinite(cvss) ? cvss.toFixed(1) : '0.0'}</strong></td>
                                <td>${attack.attack_type || 'Multiple'}</td>
                                <td>${cveCell}</td>
                                <td style="font-size: 11px;">${attack.owasp || '-'}</td>
                            </tr>
                        `;
                    }).join('');

                    recentBody.querySelectorAll('tr[data-attack-key]').forEach((tr) => {
                        tr.addEventListener('click', () => {
                            selectedAttackKey = tr.getAttribute('data-attack-key');
                            recentBody.querySelectorAll('tr').forEach(r => r.classList.remove('attack-row-selected'));
                            tr.classList.add('attack-row-selected');

                            const attack = {
                                timestamp: tr.getAttribute('data-ts') || '',
                                session_id: tr.getAttribute('data-session') || '',
                                severity: tr.getAttribute('data-severity') || '',
                                cvss_score: Number(tr.getAttribute('data-cvss') || 0),
                                attack_type: tr.getAttribute('data-type') || '',
                                cve: tr.getAttribute('data-cve') || '',
                                owasp: tr.getAttribute('data-owasp') || '',
                            };
                            analyzeAttack(attack);
                        }, { passive: true });
                    });

                    // First load: auto-analyze the newest available attack so panel is never stuck waiting.
                    if (!selectedAttackKey && top.length > 0) {
                        selectedAttackKey = makeAttackKey(top[0]);
                        const firstRow = recentBody.querySelector('tr[data-attack-key]');
                        if (firstRow) firstRow.classList.add('attack-row-selected');
                        analyzeAttack(top[0]);
                    }

                    if (newKeys.size > 0) {
                        const firstNew = top.find(a => newKeys.has(makeAttackKey(a)));
                        if (firstNew) {
                            const firstCvss = Number(firstNew.cvss_score || 0);
                            showLiveToast(
                                newKeys.size > 1 ? `New Attacks Detected (${newKeys.size})` : 'New Attack Detected',
                                `Severity ${firstNew.severity || 'UNKNOWN'} | CVSS ${Number.isFinite(firstCvss) ? firstCvss.toFixed(1) : '0.0'} | ${firstNew.attack_type || 'Multiple'}`
                            );
                            analyzeAttack(firstNew);
                        }
                    }
                } else {
                    recentBody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: rgba(242, 236, 221, 0.4);">No attacks detected yet</td></tr>';
                    const aiMeta = document.getElementById('aiMeta');
                    const aiText = document.getElementById('aiAnalysisText');
                    if (aiMeta) aiMeta.innerHTML = '<span class="ai-pill">No attacks available</span>';
                    if (aiText) aiText.textContent = 'No recent attacks yet. Submit a test payload from the login page.';
                }

            } catch (error) {
                console.error('Error loading dashboard data:', error);
                const aiMeta = document.getElementById('aiMeta');
                const aiText = document.getElementById('aiAnalysisText');
                if (aiMeta) aiMeta.innerHTML = '<span class="ai-pill">Stats API unreachable</span>';
                if (aiText && aiText.textContent === 'Waiting for an event...') {
                    aiText.textContent = 'Could not load dashboard stats. Check API endpoint/CORS/network and refresh.';
                }
            } finally {
                isDashboardLoading = false;
                if (spinner) spinner.style.display = 'none';
                if (pendingDashboardReload) {
                    pendingDashboardReload = false;
                    loadDashboardData();
                }
            }
        }

        function showClearModal() {
            document.getElementById('clearModal').style.display = 'flex';
        }

        function hideClearModal() {
            document.getElementById('clearModal').style.display = 'none';
        }

        async function confirmClearData() {
            try {
                const response = await fetch(CLEAR_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();
                
                if (result.success) {
                    alert('All attack data has been cleared successfully.');
                    hideClearModal();
                    loadDashboardData(); // Reload to show empty state
                } else {
                    alert('Failed to clear data: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error clearing data:', error);
                alert('Network error while clearing data');
            }
        }
    </script>
</body>
</html>

